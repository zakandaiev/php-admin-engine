"use strict";const mainMenu=document.querySelector("ul.list-group.sortable"),addMenuItem=document.getElementById("menu-add-item"),addMenuItemBlank=document.getElementById("menu-item-blank");function editMenuItems(){const e=JSON.stringify(formatMenuItems(getItems(mainMenu))),t=document.querySelector(".spinner-action");t.classList.add("spinner-action_active");let n=new FormData;n.set("items",e),n.set(SETTING.csrf.key,SETTING.csrf.token),fetch(t.getAttribute("data-menu-action"),{method:"POST",body:n}).then((e=>e.json())).then((e=>{SETTING.toast(e.status,e.message)})).catch((e=>{SETTING.toast("error",e)})).finally((()=>{t.classList.remove("spinner-action_active")}))}function getItems(e){let t=[];return e.querySelectorAll(".menu-list").forEach((n=>{let a={name:"#",url:"#",parent:null,children:[]};const l=n.closest("ul.list-group.sortable");l!==e&&(a.parent=getItemProp(l.previousElementSibling,"name")),a.name=getItemProp(n,"name"),a.url=getItemProp(n,"url"),t.push(a)})),t}function formatMenuItems(){let e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],a={},l=[];for(t=0;t<n.length;t+=1)a[n[t].name]=t,n[t].children=[];for(t=0;t<n.length;t+=1)e=n[t],e.parent?n[a[e.parent]].children.push(e):l.push(e);return l}function getItemProp(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"name";switch(t){case"name":var n,a;return null!==(n=null===(a=e.querySelector('.menu-item > input[name="name"]'))||void 0===a?void 0:a.value)&&void 0!==n?n:"";case"url":var l,r;return null!==(l=null===(r=e.querySelector('.menu-item > input[name="url"]'))||void 0===r?void 0:r.value)&&void 0!==l?l:"";default:return null}}null==addMenuItem||addMenuItem.addEventListener("click",(e=>{e.preventDefault();const t=addMenuItemBlank.cloneNode(!0);t.classList.remove("hidden"),t.removeAttribute("id"),mainMenu.appendChild(t),makeSortable(t.querySelector(".sortable"))})),document.addEventListener("click",(e=>{const t=e.target.closest(".menu-item__icon");t&&t.classList.contains("feather-trash")&&fadeOut(t.closest(".menu-list"),!1,"editMenuItems"),(e.target.closest("[data-bs-toggle]")||e.target.closest("[data-bs-toggle]"))&&e.preventDefault()})),document.addEventListener("focusout",(e=>{e.target.classList.contains("menu-item__input")&&editMenuItems()}));