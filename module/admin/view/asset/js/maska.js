"use strict";
/*! maska v2.1.9 | (c) Alexander Shabunevich | Released under the MIT license */!function(t,e){"object"==typeof exports&&typeof module<"u"?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=typeof globalThis<"u"?globalThis:t||self).Maska={})}(void 0,(function(t){var e=Object.defineProperty,s=(t,s,n)=>(((t,s,n)=>{s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[s]=n})(t,"symbol"!=typeof s?s+"":s,n),n);const n={"#":{pattern:/[0-9]/},"@":{pattern:/[a-zA-Z]/},"*":{pattern:/[a-zA-Z0-9]/}};class u{constructor(){var t;let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};s(this,"opts",{}),s(this,"memo",new Map);const a={...e};if(null!=a.tokens){a.tokens=a.tokensReplace?{...a.tokens}:{...n,...a.tokens};for(const t of Object.values(a.tokens))"string"==typeof t.pattern&&(t.pattern=new RegExp(t.pattern))}else a.tokens=n;Array.isArray(a.mask)&&(a.mask.length>1?a.mask=[...a.mask].sort(((t,e)=>t.length-e.length)):a.mask=null!==(t=a.mask[0])&&void 0!==t?t:""),""===a.mask&&(a.mask=null),this.opts=a}masked(t){return this.process(t,this.findMask(t))}unmasked(t){return this.process(t,this.findMask(t),!1)}isEager(){return!0===this.opts.eager}isReversed(){return!0===this.opts.reversed}completed(t){const e=this.findMask(t);if(null==this.opts.mask||null==e)return!1;const s=this.process(t,e).length;return"string"==typeof this.opts.mask?s>=this.opts.mask.length:"function"==typeof this.opts.mask?s>=e.length:this.opts.mask.filter((t=>s>=t.length)).length===this.opts.mask.length}findMask(t){var e,s;const n=this.opts.mask;if(null==n)return null;if("string"==typeof n)return n;if("function"==typeof n)return n(t);const a=this.process(t,null!==(e=n.slice(-1).pop())&&void 0!==e?e:"",!1);return null!==(s=n.find((e=>this.process(t,e,!1).length>=a.length)))&&void 0!==s?s:""}escapeMask(t){const e=[],s=[];return t.split("").forEach(((n,a)=>{"!"===n&&"!"!==t[a-1]?s.push(a-s.length):e.push(n)})),{mask:e.join(""),escaped:s}}process(t,e){let s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var n;if(null==e)return t;const a=`value=${t},mask=${e},masked=${s?1:0}`;if(this.memo.has(a))return this.memo.get(a);const{mask:i,escaped:o}=this.escapeMask(e),r=[],l=null!=this.opts.tokens?this.opts.tokens:{},p=this.isReversed()?-1:1,h=this.isReversed()?"unshift":"push",d=this.isReversed()?0:i.length-1,c=this.isReversed()?()=>g>-1&&v>-1:()=>g<i.length&&v<t.length,m=t=>!this.isReversed()&&t<=d||this.isReversed()&&t>=d;let k,f=-1,g=this.isReversed()?i.length-1:0,v=this.isReversed()?t.length-1:0;for(;c();){const e=i.charAt(g),a=l[e],c=null!=(null==a?void 0:a.transform)?a.transform(t.charAt(v)):t.charAt(v);if(o.includes(g)||null==a)s&&!this.isEager()&&r[h](e),c!==e||this.isEager()?k=e:v+=p,this.isEager()||(g+=p);else{if(null!=c.match(a.pattern))r[h](c),a.repeated?(-1===f?f=g:g===d&&g!==f&&(g=f-p),d===f&&(g-=p)):a.multiple&&(g-=p),g+=p;else if(a.multiple){const t=null!=(null==(n=r[v-p])?void 0:n.match(a.pattern)),e=i.charAt(g+p);t&&""!==e&&null==l[e]?(g+=p,v-=p):r[h]("")}else c===k?k=void 0:a.optional&&(g+=p,v-=p);v+=p}if(this.isEager())for(;m(g)&&(null==l[i.charAt(g)]||o.includes(g));)s?r[h](i.charAt(g)):i.charAt(g)===t.charAt(v)&&(v+=p),g+=p}return this.memo.set(a,r.join("")),this.memo.get(a)}}const a=t=>JSON.parse(t.replaceAll("'",'"')),i=function(t){const e={...arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}};return null!=t.dataset.maska&&""!==t.dataset.maska&&(e.mask=r(t.dataset.maska)),null!=t.dataset.maskaEager&&(e.eager=o(t.dataset.maskaEager)),null!=t.dataset.maskaReversed&&(e.reversed=o(t.dataset.maskaReversed)),null!=t.dataset.maskaTokensReplace&&(e.tokensReplace=o(t.dataset.maskaTokensReplace)),null!=t.dataset.maskaTokens&&(e.tokens=l(t.dataset.maskaTokens)),e},o=t=>""===t||!!JSON.parse(t),r=t=>t.startsWith("[")&&t.endsWith("]")?a(t):t,l=t=>{if(t.startsWith("{")&&t.endsWith("}"))return a(t);const e={};return t.split("|").forEach((t=>{const s=t.split(":");e[s[0]]={pattern:new RegExp(s[1]),optional:"optional"===s[2],multiple:"multiple"===s[2],repeated:"repeated"===s[2]}})),e};class S{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};s(this,"items",new Map),s(this,"beforeinputEvent",(t=>{const e=t.target,s=this.items.get(e);s.isEager()&&"inputType"in t&&t.inputType.startsWith("delete")&&s.unmasked(e.value).length<=1&&this.setMaskedValue(e,"")})),s(this,"inputEvent",(t=>{if(t instanceof CustomEvent&&"input"===t.type&&null!=t.detail&&"object"==typeof t.detail&&"masked"in t.detail)return;const e=t.target,s=this.items.get(e),n=e.value,a=e.selectionStart,i=e.selectionEnd;let o=n;if(s.isEager()){const e=s.masked(n),a=s.unmasked(n);""===a&&"data"in t&&null!=t.data?o=t.data:a!==s.unmasked(e)&&(o=a)}if(this.setMaskedValue(e,o),"inputType"in t&&(t.inputType.startsWith("delete")||null!=a&&a<n.length))try{e.setSelectionRange(a,i)}catch{}})),this.options=e,"string"==typeof t?this.init(Array.from(document.querySelectorAll(t)),this.getMaskOpts(e)):this.init("length"in t?Array.from(t):[t],this.getMaskOpts(e))}destroy(){for(const t of this.items.keys())t.removeEventListener("input",this.inputEvent),t.removeEventListener("beforeinput",this.beforeinputEvent);this.items.clear()}needUpdateOptions(t,e){const s=this.items.get(t),n=new u(i(t,this.getMaskOpts(e)));return JSON.stringify(s.opts)!==JSON.stringify(n.opts)}needUpdateValue(t){const e=t.dataset.maskaValue;return null==e&&""!==t.value||null!=e&&e!==t.value}getMaskOpts(t){const{onMaska:e,preProcess:s,postProcess:n,...a}=t;return a}init(t,e){for(const s of t){const t=new u(i(s,e));this.items.set(s,t),""!==s.value&&this.setMaskedValue(s,s.value),s.addEventListener("input",this.inputEvent),s.addEventListener("beforeinput",this.beforeinputEvent)}}setMaskedValue(t,e){const s=this.items.get(t);null!=this.options.preProcess&&(e=this.options.preProcess(e));const n=s.masked(e),a={masked:n,unmasked:s.unmasked(s.isEager()?n:e),completed:s.completed(e)};e=n,null!=this.options.postProcess&&(e=this.options.postProcess(e)),t.value=e,t.dataset.maskaValue=e,null!=this.options.onMaska&&(Array.isArray(this.options.onMaska)?this.options.onMaska.forEach((t=>t(a))):this.options.onMaska(a)),t.dispatchEvent(new CustomEvent("maska",{detail:a})),t.dispatchEvent(new CustomEvent("input",{detail:a}))}}const p=new WeakMap;t.Mask=u,t.MaskInput=S,t.tokens=n,t.vMaska=(t,e)=>{const s=t instanceof HTMLInputElement?t:t.querySelector("input"),n={...e.arg};if(null==s)return;(t=>{setTimeout((()=>{var e;!0===(null==(e=p.get(t))?void 0:e.needUpdateValue(t))&&t.dispatchEvent(new CustomEvent("input"))}))})(s);const a=p.get(s);if(null!=a){if(!a.needUpdateOptions(s,n))return;a.destroy()}if(null!=e.value){const t=e.value,s=e=>{t.masked=e.masked,t.unmasked=e.unmasked,t.completed=e.completed};n.onMaska=null==n.onMaska?s:Array.isArray(n.onMaska)?[...n.onMaska,s]:[n.onMaska,s]}p.set(s,new S(s,n))},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));